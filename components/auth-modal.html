<!-- Authentication Modal -->
<!-- Authentication Modal -->
<div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[9999] items-center justify-center hidden">
  <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 my-8 relative">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold" id="modal-title">Log In</h3>
      <button id="close-modal" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <div id="login-form">
      <div class="mb-4">
        <label for="login-email" class="form-label text-gray-700">Email Address</label>
        <input
          type="email"
          id="login-email"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter your email"
          required
        />
      </div>

      <div class="mb-6">
        <label for="login-password" class="form-label text-gray-700">Password</label>
        <input
          type="password"
          id="login-password"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter your password"
          required
        />
        <div class="flex justify-between mt-2">
          <div class="flex items-center">
            <input type="checkbox" id="remember-me" class="mr-2" />
            <label for="remember-me" class="text-sm text-gray-600">Remember me</label>
          </div>
          <a href="#" class="text-sm text-blue-600 hover:underline">Forgot password?</a>
        </div>
      </div>

      <button class="w-full btn-primary py-3 rounded-lg text-white font-medium mb-4">
        Log In
      </button>

      <div class="relative flex items-center justify-center mb-4">
        <div class="border-t border-gray-300 absolute w-full"></div>
        <span class="bg-white px-2 text-sm text-gray-500 relative">OR</span>
      </div>

      <div class="space-y-3">
        <button class="w-full py-3 px-4 border border-gray-300 rounded-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
          <i class="fa-brands fa-google mr-3"></i>
          <span>Continue with Google</span>
        </button>
        <button class="w-full py-3 px-4 bg-blue-600 text-white rounded-lg flex items-center justify-center hover:bg-blue-700 transition-colors">
          <i class="fab fa-facebook-f mr-3"></i>
          <span>Continue with Facebook</span>
        </button>
      </div>

      <div class="text-center mt-6">
        <p class="text-gray-600">
          Don't have an account?
          <a href="#" id="switch-to-signup" class="text-blue-600 font-medium hover:underline">Sign Up</a>
        </p>
      </div>
    </div>

    <div id="signup-form" style="display: none;">
      <div class="mb-4">
        <label for="signup-name" class="form-label text-gray-700">Full Name</label>
        <input
          type="text"
          id="signup-name"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter your full name"
          required
        />
      </div>

      <div class="mb-4">
        <label for="signup-email" class="form-label text-gray-700">Email Address</label>
        <input
          type="email"
          id="signup-email"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Enter your email"
          required
        />
      </div>

      <div class="mb-4">
        <label for="signup-password" class="form-label text-gray-700">Password</label>
        <input
          type="password"
          id="signup-password"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Create a password"
          required
        />
        <p class="text-xs text-gray-500 mt-1">
          Password must be at least 8 characters and include a number and special character
        </p>
      </div>

      <div class="mb-6">
        <label for="signup-confirm-password" class="form-label text-gray-700">Confirm Password</label>
        <input
          type="password"
          id="signup-confirm-password"
          class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Confirm your password"
          required
        />
      </div>

      <div class="mb-6">
        <div class="flex items-start">
          <input type="checkbox" id="terms" class="mt-1 mr-2" required />
          <label for="terms" class="text-sm text-gray-600">
            I agree to the
            <a href="#" class="text-blue-600 hover:underline">Terms of Service</a>
            and
            <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a>
          </label>
        </div>
      </div>

      <button class="w-full btn-primary py-3 rounded-lg text-white font-medium mb-4">
        Create Account
      </button>

      <div class="relative flex items-center justify-center mb-4">
        <div class="border-t border-gray-300 absolute w-full"></div>
        <span class="bg-white px-2 text-sm text-gray-500 relative">OR</span>
      </div>

      <div class="space-y-3">
        <button class="w-full py-3 px-4 border border-gray-300 rounded-lg flex items-center justify-center hover:bg-gray-50 transition-colors">
          <i class="fa-brands fa-google mr-3"></i>
          <span>Sign up with Google</span>
        </button>
        <button class="w-full py-3 px-4 bg-blue-600 text-white rounded-lg flex items-center justify-center hover:bg-blue-700 transition-colors">
          <i class="fab fa-facebook-f mr-3"></i>
          <span>Sign up with Facebook</span>
        </button>
      </div>

      <div class="text-center mt-6">
        <p class="text-gray-600">
          Already have an account?
          <a href="#" id="switch-to-login" class="text-blue-600 font-medium hover:underline">Log In</a>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Debug overlay to help identify issues -->
<div id="modal-debug" style="position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.8); color: white; padding: 10px; z-index: 10000; font-size: 12px; display: none;"></div>

<!-- Standalone Modal Script -->
<script>
(function() {
  // Initialize on script load with delayed execution
  console.log('Auth modal script loading');
  
  // Initialize only once
  if (window.authModalInitialized) return;
  window.authModalInitialized = true;
  
  function showDebug(message) {
    const debugElement = document.getElementById('modal-debug');
    if (debugElement) {
      debugElement.textContent += message + '\n';
      debugElement.style.display = 'block';
    } else {
      console.log('Debug:', message);
    }
  }
  
  // Enable debug mode
  const DEBUG = true;
  
  if (DEBUG) {
    document.getElementById('modal-debug').style.display = 'block';
    showDebug('Auth modal debugging enabled');
  }
  
  // Keep trying to find elements until they exist
  function initializeWhenElementsExist() {
    // Elements we need to find
    const modalElements = {
      modal: document.getElementById('auth-modal'),
      modalTitle: document.getElementById('modal-title'),
      closeBtn: document.getElementById('close-modal'),
      loginForm: document.getElementById('login-form'),
      signupForm: document.getElementById('signup-form'),
      switchToLogin: document.getElementById('switch-to-login'),
      switchToSignup: document.getElementById('switch-to-signup')
    };
    
    // Check if all required elements exist
    const missingElements = Object.entries(modalElements)
      .filter(([key, element]) => !element)
      .map(([key]) => key);
    
    if (missingElements.length > 0) {
      showDebug(`Still missing elements: ${missingElements.join(', ')}`);
      // Try again in 300ms
      setTimeout(initializeWhenElementsExist, 300);
      return;
    }
    
    showDebug('All elements found, initializing auth modal');
    
    // Variables
    let isOpen = false;
    let currentView = 'login';
    let originalOverflow = '';
    
    // Add modal-specific styles to ensure visibility
    const style = document.createElement('style');
    style.textContent = `
      #auth-modal {
        display: none;
        align-items: flex-start;
        overflow-y: auto;
        padding: 20px 0;
      }
      #auth-modal > div {
        margin: auto;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
      }
      #auth-modal.modal-open {
        display: flex !important;
      }
    `;
    document.head.appendChild(style);
    
    // Functions
    function openModal() {
      showDebug('Opening modal');
      modalElements.modal.classList.add('modal-open');
      // Force display style to ensure visibility
      modalElements.modal.style.display = 'flex';
      originalOverflow = document.body.style.overflow;
      document.body.style.overflow = 'hidden';
      isOpen = true;
    }
    
    function closeModal() {
      showDebug('Closing modal');
      modalElements.modal.classList.remove('modal-open');
      modalElements.modal.style.display = 'none';
      document.body.style.overflow = originalOverflow;
      isOpen = false;
    }
    
    function showLogin() {
      showDebug('Showing login form');
      currentView = 'login';
      modalElements.modalTitle.textContent = 'Log In';
      modalElements.loginForm.style.display = 'block';
      modalElements.signupForm.style.display = 'none';
      openModal();
    }
    
    function showSignup() {
      showDebug('Showing signup form');
      currentView = 'signup';
      modalElements.modalTitle.textContent = 'Sign Up';
      modalElements.loginForm.style.display = 'none';
      modalElements.signupForm.style.display = 'block';
      openModal();
    }
    
    // Setup listeners
    function setupListeners() {
      showDebug('Setting up event listeners');
      
      // Close button
      if (modalElements.closeBtn) {
        modalElements.closeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          closeModal();
        });
        showDebug('Close button listener added');
      }
      
      // Toggle between login and signup
      if (modalElements.switchToLogin) {
        modalElements.switchToLogin.addEventListener('click', function(e) {
          e.preventDefault();
          showLogin();
        });
        showDebug('Switch to login listener added');
      }
      
      if (modalElements.switchToSignup) {
        modalElements.switchToSignup.addEventListener('click', function(e) {
          e.preventDefault();
          showSignup();
        });
        showDebug('Switch to signup listener added');
      }
      
      // Find login and signup buttons
      const loginBtn = document.getElementById('login-btn');
      const signupBtn = document.getElementById('signup-btn');
      
      // Add listeners to header buttons
      if (loginBtn) {
        loginBtn.addEventListener('click', function(e) {
          e.preventDefault();
          showDebug('Login button clicked');
          showLogin();
        });
        showDebug('Main login button listener added');
      } else {
        showDebug('Warning: Login button not found');
      }
      
      if (signupBtn) {
        signupBtn.addEventListener('click', function(e) {
          e.preventDefault();
          showDebug('Signup button clicked');
          showSignup();
        });
        showDebug('Main signup button listener added');
      } else {
        showDebug('Warning: Signup button not found');
      }
      
      // Mobile menu buttons (if they exist)
      const mobileMenu = document.getElementById('mobile-menu');
      if (mobileMenu) {
        const mobileButtons = mobileMenu.querySelectorAll('button');
        const mobileLoginBtn = mobileButtons[0];
        const mobileSignupBtn = mobileButtons[1];
        
        if (mobileLoginBtn) {
          mobileLoginBtn.addEventListener('click', function() {
            showDebug('Mobile login button clicked');
            // Close mobile menu if possible
            if (window.MobileMenu && typeof MobileMenu.close === 'function') {
              MobileMenu.close();
            }
            showLogin();
          });
          showDebug('Mobile login button listener added');
        }
        
        if (mobileSignupBtn) {
          mobileSignupBtn.addEventListener('click', function() {
            showDebug('Mobile signup button clicked');
            // Close mobile menu if possible
            if (window.MobileMenu && typeof MobileMenu.close === 'function') {
              MobileMenu.close();
            }
            showSignup();
          });
          showDebug('Mobile signup button listener added');
        }
      } else {
        showDebug('Mobile menu not found');
      }
      
      // Click outside modal to close
      modalElements.modal.addEventListener('click', function(e) {
        if (e.target === modalElements.modal) {
          closeModal();
        }
      });
      
      // Escape key to close
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && isOpen) {
          closeModal();
        }
      });
      
      showDebug('All auth modal listeners initialized');
    }
    
    // Emergency backup buttons if needed
    if (DEBUG) {
      const debugButtons = document.createElement('div');
      debugButtons.innerHTML = `
        <div style="position: fixed; top: 10px; right: 200px; z-index: 10000">
          <button id="debug-login-btn" style="background: blue; color: white; padding: 5px 10px; margin-right: 5px">Debug Login</button>
          <button id="debug-signup-btn" style="background: green; color: white; padding: 5px 10px">Debug Signup</button>
        </div>
      `;
      document.body.appendChild(debugButtons);
      
      document.getElementById('debug-login-btn').addEventListener('click', function() {
        showDebug('Debug login button clicked');
        showLogin();
      });
      
      document.getElementById('debug-signup-btn').addEventListener('click', function() {
        showDebug('Debug signup button clicked');
        showSignup();
      });
    }
    
    // Setup all listeners
    setupListeners();
    
    // Expose functions globally
    window.AuthModal = {
      showLogin: showLogin,
      showSignup: showSignup,
      close: closeModal,
      isModalOpen: function() { return isOpen; },
      initialized: true,
      debug: function() {
        showDebug('Current modal state:');
        showDebug(`Modal element exists: ${!!modalElements.modal}`);
        showDebug(`Login form exists: ${!!modalElements.loginForm}`);
        showDebug(`Signup form exists: ${!!modalElements.signupForm}`);
        showDebug(`Is modal open: ${isOpen}`);
        showDebug(`Current view: ${currentView}`);
        
        // Force show debug panel
        document.getElementById('modal-debug').style.display = 'block';
      }
    };
    
    showDebug('Auth modal ready');
  }
  
  // Start trying to find elements and initialize
  if (document.readyState === 'loading') {
    // If document still loading, wait for it
    document.addEventListener('DOMContentLoaded', initializeWhenElementsExist);
  } else {
    // If document already loaded, try now
    initializeWhenElementsExist();
  }
})();
</script>